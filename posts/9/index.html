
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Udooz!</title>
  <meta name="author" content="M Sheik Uduman Ali">

  
  <meta name="description" content="Parameters with default value. Hence, explicit values not specified in the calling place, default value has been taken. 1
2
3
4
static void Power(int &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://udooz.github.io//blog/posts/9/">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="/blog/javascripts/ender.js"></script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Udooz!" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:udooz.github.io//blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/blog/">
        <span class="blue_light">
            Udooz!
        </span>
       
           <span class="blue_dark">
             technologies.each { |tech| write_post(tech.facets) if tech.facets
           </span>
       
    </a></li>
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
  <li><a href="/blog/about">About me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/02/c-4-0-crash-course-optional-and-named-parameter/">C# 4.0 Crash Course: Optional and Named Parameter</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-02-15T00:00:00+05:30" pubdate data-updated="true"></time>
        
         | <a href="/blog/2010/02/c-4-0-crash-course-optional-and-named-parameter/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Parameters with default value. Hence, explicit values not specified in the calling place, default value has been taken.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">static</span> <span class="k">void</span> <span class="nf">Power</span><span class="p">(</span><span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p</span> <span class="p">=</span> <span class="m">2</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;{0} Power of {1} = {2}&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">Math</span><span class="p">.</span><span class="n">Pow</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><span style="color: #800080;">p</span> is the optional parameter here. By default <span style="color: #800080;">Power</span> does calculate square of <span style="color: #800080;">v</span>, if <span style="color: #800080;">p</span> value provided explicitly, does calculate <span style="color: #800080;">v</span> to the power of <span style="color: #800080;">p</span>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">Power</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">);</span>  <span class="c1">// 2 ** 3 = 8</span>
</span><span class='line'><span class="n">Power</span><span class="p">(</span><span class="m">4</span><span class="p">);</span> <span class="c1">// 4 ** 2 = 16</span>
</span></code></pre></td></tr></table></div></figure>


<p>Actually, two parameter target attributes help to make this feature available. These are:</p>

<ul>
<li><span style="color: #800080;">OptionalAttribute</span></li>
<li><span style="color: #800080;">DefaultParameterValueAttribute</span></li>
</ul>


<p>in <span style="color: #800080;">System.Runtime.InteropServices</span> namespace.</p>

<p>The OptionalAttribute marks the parameter as optional as like</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">static</span> <span class="k">void</span> <span class="nf">Power</span><span class="p">(</span><span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="n">Optional</span><span class="p">]</span> <span class="n">p</span><span class="p">)</span> <span class="p">{...}</span> <span class="c1">// p&#39;s default value is to default(int) i.e. 0</span>
</span><span class='line'>
</span><span class='line'><span class="n">Power</span><span class="p">(</span><span class="m">5</span><span class="p">);</span> <span class="c1">// prints 1</span>
</span></code></pre></td></tr></table></div></figure>


<p>The DefaultParameterValueAttribute constructor takes value parameter of type object is used to initialize the default value of the target parameter.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">static</span> <span class="k">void</span> <span class="nf">Power</span><span class="p">(</span><span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="n">Optional</span><span class="p">][</span><span class="n">DefaultParameterValue</span><span class="p">(</span><span class="m">2</span><span class="p">)]</span> <span class="n">p</span><span class="p">)</span> <span class="p">{...}</span> <span class="c1">// p&#39;s default value is 2</span>
</span></code></pre></td></tr></table></div></figure>


<p>Points to be noted on &#8220;optional&#8221; parameter usage:</p>

<ul>
<li>Optional parameter should be the last parameter as like &#8220;param&#8221; usage
ref and <span style="color: #800080;">out</span> parameters.</ul>

<h2>Named Parameters</h2></li>
</ul>


<p>Optional parameter will not be useful in real without named parameters. Yes, the name itself tells the answer. What will you do if you have more than one optional parameters and at the calling place, you want to pass actual value for less number of optional parameters. For example</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">static</span> <span class="k">void</span> <span class="nf">MoreOptionalParamMethod</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span> <span class="p">=</span> <span class="m">2</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;a= {0}, b= {1}, c= {2}, &quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, you want to pass the value of variable b only. Named parameter will help you.</p>

<blockquote><p>Instead of parameter order, you can explictly specify parameter name along with the value using &#8220;:&#8221; in the calling place</p></blockquote>

<p>See the following calling place</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">MoreOptionalParamMethod</span><span class="p">(</span><span class="n">b</span><span class="p">:</span> <span class="m">5</span><span class="p">);</span> <span class="c1">// prints a= 0, b= 5, c= 2</span>
</span></code></pre></td></tr></table></div></figure>


<p>There is no surprising in the IL code, the compiler replaces optional parameters with default values as like below</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">MoreOptionalParamMethod</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>The only thing to be considered is named and normal parameters can be mixed but normal parameter should be come first.</p>

<p><a style="display: none;" rel="tag" href="http://www.codeproject.com/script/Articles/BlogFeedList.aspx?amid=3057856">CodeProject</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/01/net-caching-solutions-review/">.NET Caching Solutions &#8211; A Pre-Velocity Review</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-22T00:00:00+05:30" pubdate data-updated="true"></time>
        
         | <a href="/blog/2010/01/net-caching-solutions-review/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Caching is one of the vital aspect for enterprise applications.  ASP.NET Cache is not enough and even not suitable for service layer which is now more predominantly occupied by WCF. A robustic and scalable memory caching solution is required to cache different types of data.  I&#8217;m the beliver of &#8220;<strong>RAM is disk</strong>&#8221; for service layer.  <a href="http://msdn.microsoft.com/en-us/library/dd203226.aspx" target="_blank">Enterprise Library Caching Application Block (CAB)</a> from Microsoft PnP team provides an in-process memory caching, however it is not scalable and robust. But, its provider pattern is an elegant model for application design, so that you can plug any caching solutions.</p>

<p>Recently, I was in a situation to find out suitable caching solution for our WCF based service layer.  Although, Microsoft yet to avail its &#8220;Windows Server AppFabric&#8221; to the .NET/WCF world (which might be the filler of .NET peoples&#8217; decade old expectation), there are some caching solutions available from third parties. </p>

<p>I did a small evaluation on the following caching solutions:</p>

<ul>
<li>NCache Express</li>
<li>Shared Cache</li>
<li>Memcached</li>
<li>Enterprise Library 4.1</li>
</ul>


<blockquote><p>Disclaimer: The test was done at very small scale and not included the scalability factors.  Memory and CPU consumption were not covered.</p></blockquote>

<p><a href="http://www.alachisoft.com/ncache/" target="_blank">NCache</a> supports different caching topologies and types with many features like Object Query Language, remote clustering, etc.  I&#8217;ve taken its express edition for this evaulation.  <a href="http://www.sharedcache.com/cms/" target="_blank">Shared Cache</a> is 100% written in C# with distributed caching and three different topologies.  It supports WCF DataContractSerializer in addition with BinarySerializer.  Guys from *nux world knows the defacto caching solution &#8220;<a href="http://memcached.org/" target="_blank">memcached</a>&#8220;.  It has Win32/64 avatar too and some open source managed client libraries also available.  I used Danga Interactive 32-bit version of memcached 1.2.6 (<a href="http://code.jellycan.com/memcached/" target="_blank"><a href="http://code.jellycan.com/memcached/">http://code.jellycan.com/memcached/</a></a>) and BeIT Memcached managed client (<a href="http://code.google.com/p/beitmemcached/" target="_blank"><a href="http://code.google.com/p/beitmemcached/">http://code.google.com/p/beitmemcached/</a></a>).  64-bit Windows version is available at <a href="http://labs.northscale.com/memcached-packages/" target="_blank"><a href="http://labs.northscale.com/memcached-packages/">http://labs.northscale.com/memcached-packages/</a></a>.</p>

<p>I&#8217;d done a small performance testing on the above solutions.  In addition to these, I&#8217;ve used Enterprise Library 4.1 CAB provider model and implement provider for these solutions.  So, following different solutions had been tested:</p>

<ul>
<li>Enterprise Library 4.1 CAB</li>
<li>Memcached</li>
<li>Enterprise Library 4.1 based Memcached</li>
<li>Shared Cache</li>
<li>Enterprise Library 4.1 based Shared Cache</li>
<li>NCache Express</li>
<li>Enterprise Library 4.1 based NCache Express</li>
</ul>


<p>Following three different test had been done on every solutions, totally 21 test:</p>

<ul>
<li>Adding 1000 items &amp; Getting these items</li>
<li>Adding 1000 items &amp; Getting 5th element</li>
<li>Adding 1000 items &amp; Getting 995th element</li>
</ul>


<p>The testing was performed on Intel Pentium 4 3.2GHz, 2GB RAM running WinXP SP2.</p>

<p>Let us see the results and, pros and cons of these solutions.</p>

<h2>Enterprise Library 4.1</h2>

<p>Not surprisingly excellent performance due to in-process memory caching, however not suitable for enterprise scale.  This supports primitive and Serializable objects.</p>

<table border="0" cellspacing="0" cellpadding="0" width="548">
  <colgroup span="1"> <col span="1" width="228"></col> <col span="5" width="64"></col> </colgroup> <tr height="20">
    <td width="228" height="20">
       
    </td>
    
    <td style="TEXT-ALIGN: center" colspan="5" width="320">
      <strong>EntLib 4.1</strong>
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
       
    </td>
    
    <td style="TEXT-ALIGN: center">
      R1
    </td>
    
    <td style="TEXT-ALIGN: center">
      R2
    </td>
    
    <td style="TEXT-ALIGN: center">
      R3
    </td>
    
    <td style="TEXT-ALIGN: center">
      R4
    </td>
    
    <td style="TEXT-ALIGN: center">
      Avg
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Adding 1000 items (in ms)
    </td>
    
    <td align="right">
      21
    </td>
    
    <td align="right">
      13
    </td>
    
    <td align="right">
      23
    </td>
    
    <td align="right">
      12
    </td>
    
    <td align="right">
      17.25
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Getting 1000 items (in ms)
    </td>
    
    <td align="right">
      9
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      9
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      7
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 5th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      4
    </td>
    
    <td align="right">
      3
    </td>
    
    <td align="right">
      3
    </td>
    
    <td align="right">
      2
    </td>
    
    <td align="right">
      3
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 995th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      4
    </td>
    
    <td align="right">
      3
    </td>
    
    <td align="right">
      3
    </td>
    
    <td align="right">
      2
    </td>
    
    <td align="right">
      3
    </td>
  </tr>
</table>


<p>The &#8220;R&#8221; deonotes &#8220;Run&#8221;.  I did 4 runs for every test.</p>

<h2>Memcached</h2>

<p>Since, the OS calls for *nux memcached and Windows memcached is different, some bloggers cautioned memcached on windows is might not be a win-win.  But, I could not find any degrades in my testing.  It takes small memory foot-print and CPU usage.  It supports primitive and Serializable objects.  However, the Win32 service version does not have flexible configuration.</p>

<table border="0" cellspacing="0" cellpadding="0" width="548">
  <colgroup span="1"> <col span="1" width="228"></col> <col span="5" width="64"></col> </colgroup> <tr height="20">
    <td width="228" height="20">
       
    </td>
    
    <td style="TEXT-ALIGN: center" colspan="5" width="320">
      <strong>MemCached</strong>
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
       
    </td>
    
    <td>
      R1
    </td>
    
    <td>
      R2
    </td>
    
    <td>
      R3
    </td>
    
    <td>
      R4
    </td>
    
    <td style="TEXT-ALIGN: center">
      Avg
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Adding 1000 items (in ms)
    </td>
    
    <td align="right">
      166
    </td>
    
    <td align="right">
      160
    </td>
    
    <td align="right">
      203
    </td>
    
    <td align="right">
      164
    </td>
    
    <td align="right">
      173.25
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Getting 1000 items (in ms)
    </td>
    
    <td align="right">
      154
    </td>
    
    <td align="right">
      140
    </td>
    
    <td align="right">
      175
    </td>
    
    <td align="right">
      138
    </td>
    
    <td align="right">
      151.75
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 5th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      5
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 995th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      5
    </td>
  </tr>
</table>




<table border="0" cellspacing="0" cellpadding="0" width="548">
  <colgroup span="1"> <col span="1" width="228"></col> <col span="5" width="64"></col> </colgroup> <tr height="20">
    <td width="228" height="20">
       
    </td>
    
    <td style="TEXT-ALIGN: center" colspan="5" width="320">
      <strong>EntLib MemCached</strong>
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
       
    </td>
    
    <td>
      R1
    </td>
    
    <td>
      R2
    </td>
    
    <td>
      R3
    </td>
    
    <td>
      R4
    </td>
    
    <td style="TEXT-ALIGN: center">
      Avg
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Adding 1000 items (in ms)
    </td>
    
    <td align="right">
      178
    </td>
    
    <td align="right">
      164
    </td>
    
    <td align="right">
      202
    </td>
    
    <td align="right">
      193
    </td>
    
    <td align="right">
      184.25
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Getting 1000 items (in ms)
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      3
    </td>
    
    <td align="right">
      6
    </td>
    
    <td align="right">
      3
    </td>
    
    <td align="right">
      4.25
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 5th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      2
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
      0.5
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 995th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      2
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
      0.5
    </td>
  </tr>
</table>


<h2>Shared Cache</h2>

<p>Like Enterprise Library 4.1 CAB, this solution uses provider like model and come out with IndexusDistributionCache which supports WCF data contract serializer too in addition with binary serializer.</p>

<table border="0" cellspacing="0" cellpadding="0" width="548">
  <colgroup span="1"> <col span="1" width="228"></col> <col span="5" width="64"></col> </colgroup> <tr height="20">
    <td width="228" height="20">
       
    </td>
    
    <td style="TEXT-ALIGN: center" colspan="5" width="320">
      <strong>SharedCache</strong>
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
       
    </td>
    
    <td>
      R1
    </td>
    
    <td>
      R2
    </td>
    
    <td>
      R3
    </td>
    
    <td>
      R4
    </td>
    
    <td style="TEXT-ALIGN: center">
      Avg
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Adding 1000 items (in ms)
    </td>
    
    <td align="right">
      4723
    </td>
    
    <td align="right">
      3441
    </td>
    
    <td align="right">
      3904
    </td>
    
    <td align="right">
      3592
    </td>
    
    <td align="right">
      3915
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Getting 1000 items (in ms)
    </td>
    
    <td align="right">
      3357
    </td>
    
    <td align="right">
      3633
    </td>
    
    <td align="right">
      4582
    </td>
    
    <td align="right">
      3722
    </td>
    
    <td align="right">
      3823.5
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 5th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      12
    </td>
    
    <td align="right">
      14
    </td>
    
    <td align="right">
      17
    </td>
    
    <td align="right">
      13
    </td>
    
    <td align="right">
      14
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 995th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      13
    </td>
    
    <td align="right">
      14
    </td>
    
    <td align="right">
      13
    </td>
    
    <td align="right">
      14
    </td>
    
    <td align="right">
      13.5
    </td>
  </tr>
</table>




<table border="0" cellspacing="0" cellpadding="0" width="548">
  <colgroup span="1"> <col span="1" width="228"></col> <col span="5" width="64"></col> </colgroup> <tr height="20">
    <td width="228" height="20">
       
    </td>
    
    <td style="TEXT-ALIGN: center" colspan="5" width="320">
      <strong>EntLib SharedCache</strong>
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
       
    </td>
    
    <td>
      R1
    </td>
    
    <td>
      R2
    </td>
    
    <td>
      R3
    </td>
    
    <td>
      R4
    </td>
    
    <td style="TEXT-ALIGN: center">
      Avg
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Adding 1000 items (in ms)
    </td>
    
    <td align="right">
      3649
    </td>
    
    <td align="right">
      3612
    </td>
    
    <td align="right">
      4379
    </td>
    
    <td align="right">
      4992
    </td>
    
    <td align="right">
      4158
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Getting 1000 items (in ms)
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      2
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      3
    </td>
    
    <td align="right">
      3.75
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 5th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      3
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
      0.75
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 995th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      3
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
      0.75
    </td>
  </tr>
</table>


<h2>NCache</h2>

<p>This is more matured and tailored solution for .NET world.  The best is the object is not necessarily Serializable.</p>

<table border="0" cellspacing="0" cellpadding="0" width="548">
  <colgroup span="1"> <col span="1" width="228"></col> <col span="5" width="64"></col> </colgroup> <tr height="20">
    <td width="228" height="20">
       
    </td>
    
    <td style="TEXT-ALIGN: center" colspan="5" width="320">
      <strong>Ncache</strong>
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
       
    </td>
    
    <td>
      R1
    </td>
    
    <td>
      R2
    </td>
    
    <td>
      R3
    </td>
    
    <td>
      R4
    </td>
    
    <td style="TEXT-ALIGN: center">
      Avg
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Adding 1000 items (in ms)
    </td>
    
    <td align="right">
      365
    </td>
    
    <td align="right">
      282
    </td>
    
    <td align="right">
      382
    </td>
    
    <td align="right">
      296
    </td>
    
    <td align="right">
      331.25
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Getting 1000 items (in ms)
    </td>
    
    <td align="right">
      257
    </td>
    
    <td align="right">
      248
    </td>
    
    <td align="right">
      287
    </td>
    
    <td align="right">
      234
    </td>
    
    <td align="right">
      256.5
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 5th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      12
    </td>
    
    <td align="right">
      8
    </td>
    
    <td align="right">
      10
    </td>
    
    <td align="right">
      8
    </td>
    
    <td align="right">
      9.5
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 995th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      12
    </td>
    
    <td align="right">
      8
    </td>
    
    <td align="right">
      8
    </td>
    
    <td align="right">
      8
    </td>
    
    <td align="right">
      9
    </td>
  </tr>
</table>




<table border="0" cellspacing="0" cellpadding="0" width="548">
  <colgroup span="1"> <col span="1" width="228"></col> <col span="5" width="64"></col> </colgroup> <tr height="20">
    <td width="228" height="20">
       
    </td>
    
    <td style="TEXT-ALIGN: center" colspan="5" width="320">
      <strong>EntLib Ncache</strong>
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
                  
    </td>
    
    <td>
        R1
    </td>
    
    <td>
      R2
    </td>
    
    <td>
      R3
    </td>
    
    <td>
      R4
    </td>
    
    <td style="TEXT-ALIGN: center">
      Avg
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Adding 1000 items (in ms)
    </td>
    
    <td align="right">
      317
    </td>
    
    <td align="right">
      277
    </td>
    
    <td align="right">
      367
    </td>
    
    <td align="right">
      278
    </td>
    
    <td align="right">
      309.75
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Getting 1000 items (in ms)
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      2
    </td>
    
    <td align="right">
      5
    </td>
    
    <td align="right">
      3
    </td>
    
    <td align="right">
      3.75
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 5th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      2
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
      0.5
    </td>
  </tr>
  
  <tr height="20">
    <td height="20">
      Get 995th item (1000 items) (in ms)
    </td>
    
    <td align="right">
      3
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
    </td>
    
    <td align="right">
      0.75
    </td>
  </tr>
</table>


<p>The results shows Memcached performed better for its consistent performance and simplicity.  The surprising fact is that the above all solutions perform well in Enterprise Library 4.1 CAB provider model than their default mode.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/google-go-not-love-first-sight/">Google GO &#8211; NOT Love @ First Sight</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-11T00:00:00+05:30" pubdate data-updated="true"></time>
        
         | <a href="/blog/2009/11/google-go-not-love-first-sight/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Finally, Google makes its contribution apart from &#8220;www&#8221; after its yet another linux distro Google Chrome OS.  This time in language space.  Its name is &#8220;Go&#8221;.</p>

<p>Its released for Linux and Mac only.  After downloading the source from <a href="http://golang.org/doc/install.html" target="_blank"><a href="https://go.googlecode.com/hg,">https://go.googlecode.com/hg,</a></a> building the packages and set some environment variables (guide @ <a href="http://golang.org/doc/install.html" target="_blank"><a href="http://golang.org/doc/install.html">http://golang.org/doc/install.html</a></a>), tried a small sample which greets the arg(0) given from console.</p>

<p>The syntax is neither smart nor friendlier at my first sight.  Seems it is a mix of JavaScript, Java and ofcourse, C++.  For each and every compilation you need to specify target machine architecture, 6g &#8211; for AMD, 8g &#8211; for 386.</p>

<p>See the following sample hello, <user> sample:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="n">package</span> <span class="n">main</span>
</span><span class='line'>
</span><span class='line'><span class="n">import</span> <span class="p">(</span>
</span><span class='line'><span class="s">&quot;fmt&quot;</span><span class="p">;</span> <span class="c1">// formatted stdin</span>
</span><span class='line'><span class="s">&quot;flag&quot;</span><span class="p">;</span> <span class="c1">// command line parser</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">func</span> <span class="n">main</span><span class="p">(){</span>
</span><span class='line'> <span class="n">flag</span><span class="p">.</span><span class="n">Parse</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'> <span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">&quot;hello,&quot;</span> <span class="o">+</span> <span class="n">flag</span><span class="p">.</span><span class="n">Arg</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>After the compilation with 8g, invoke the linker 8l and generate the executable (normally 8.out).  Since I did not evaluate this language at some level and did not read its architecture, I could not give any comments of this early stage compiler. However, at my first sight,</p>

<p><strong>GO = Neither C# Nor Ruby</strong></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/08/net-4-0-work-stealing-queue-plinq/">.NET 4.0 Work Stealing Queue, Parallel and PLINQ</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-08-27T00:00:00+05:30" pubdate data-updated="true"></time>
        
         | <a href="/blog/2009/08/net-4-0-work-stealing-queue-plinq/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In <a href="http://udooz.net/blog/2009/08/parallel-programming-net-4-0-using-task/" target="_self">my previous post</a>, we have seen basis of Task Parallel Library, where I have mentioned new task scheduler in .NET 4.0 thread pool.  In this post I brief about it along with &#8220;Task&#8221; class.   Before this, let us see how to make LINQ as parallel using PLINQ.</p>

<h2>PLINQ</h2>

<p>PLINQ has implementation of  all LINQ to Objects extension methods in <span style="color: #993300;">System.Linq.ParallelEnumerable </span>for <span style="color: #993300;">IEnumerable</span>.  To make an <span style="color: #993300;">IEnumerable</span> parallel, you simply call <span style="color: #993300;">AsParallel()</span> extension method.  <span style="color: #993300;">AsParallel()</span> internally calls <span style="color: #993300;">System.Linq.Parallel.ParallelEnumerableWrapper</span> which is of type <span style="color: #993300;">System.Linq.ParallelQuery<TSource></span>.  Let us take the same customer-order example as shown in <a href="http://udooz.net/blog/2009/08/parallel-programming-net-4-0-using-task/" target="_self">my previous post</a> with  PLINQ enabled.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="kt">var</span> <span class="n">customersForOrderId7</span> <span class="p">=</span>
</span><span class='line'>    <span class="k">from</span> <span class="n">c</span> <span class="k">in</span> <span class="n">customers</span><span class="p">.</span><span class="n">AsParallel</span><span class="p">()</span>
</span><span class='line'>    <span class="k">from</span> <span class="n">o</span> <span class="k">in</span> <span class="n">c</span><span class="p">.</span><span class="n">Orders</span>
</span><span class='line'>    <span class="k">where</span> <span class="n">o</span><span class="p">.</span><span class="n">OrderId</span> <span class="p">==</span> <span class="m">7</span>
</span><span class='line'>    <span class="k">select</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'> 
</span><span class='line'>
</span><span class='line'><span class="n">customersForOrderId7</span><span class="p">.</span><span class="n">ForAll</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span>
</span><span class='line'>    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">ToString</span><span class="p">()));</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above code selects customers who have ordered OrderId 7.  <span style="color: #993300;">AsParallel()</span> at line 3 makes <span style="color: #993300;">Customer[]</span> as parallel enabled.  In this example, you can see that instead of typical <span style="color: #993300;">for&#8230;each</span>, I&#8217;ve used <span style="color: #993300;">ForAll()</span>.  This differs from <span style="color: #993300;">for..each,</span> means that for..each preservs the final order of the results.</p>

<h2>Thread Pool and Work Stealing Queue</h2>

<p>Until .NET3.5, we can queue our work items as thread in to <span style="color: #993300;">ThreadPool</span> using <span style="color: #993300;">QueueUserWorkItem()</span>.  In .NET 4.0, improvements had been made in the thread pool.  It is now based on <span style="color: #993300;">System.Threading.Tasks.Task</span>. </p>

<h3>Task</h3>

<p>Task is a work item which can be executed independently along with other tasks, technically it represents an asynchronous operation i.e. <span style="color: #993300;">System.Action</span>.  It is defined in <span style="color: #993300;">System.Threading.Tasks.Task</span> which enables you to do the following actions on a task instance:</p>

<ul>
<li>start &#8211; to start the instance</li>
<li>wait &#8211; to wait to for a task to complete</li>
<li>cancel &#8211; cancel the task asynchronously</li>
</ul>


<blockquote><p>It seems that task is a lite version of thread.</p></blockquote>

<h3>Thread Pool</h3>

<p>Following diagram shows the conceptual view of .NET 4.0 thread pool.</p>

<p><img class="alignnone size-full wp-image-185" style="margin: 2px; border: black 1px solid;" title=".NET 4.0 Thread Pool" src="http://udooz.github.io//blog/images/2009/08/pfx_thread_pool_2.png" alt=".NET 4.0 Thread Pool" width="405" height="287" /></p>

<p>Previously, thread pool had only one queue on which all the work items were queued and enqueued in FIFO order (ofcourse, thats why queue).  The worker threads are allocated for every work item access the work item from this queue.  In .NET 4.0, it has been improved by introducing <em>local queue</em> for every worker thread, in addition to qlobal queue.  Tasks those are created by program thread queued on global queue.  The task scheduler enqueues the tasks from global queue in FIFO order and distributes to respective worker thread&#8217;s local queue.  The worker thread enqueues the tasks from its local queue in LIFO order.  Interesting!</p>

<blockquote><p>The introduction of local queue makes these threads can be executed on different processors without contention issue which normally occur in single queue thread pool.  The reason for worker thread picking up the tasks in LIFO order is the assumption that &#8220;last-in&#8221; is hot to act which results no qurantee in task ordering, but better performance.</p></blockquote>

<h3>Work Stealing Queue</h3>

<p>Let us assume that worker thread 1 completed all of its tasks in the queue.  It scans the global queue for any task and if nothing there, it scans other worker thread&#8217;s local queue.  In this case, let us assume there are two tasks in WT2 queue.  WT1 enqueues first-in task from WT2 queue which avoids contention issue.  Getting tasks from other local queue is called as <em>work stealing</em>.  This again results better performance.</p>

<h2>References</h2>

<p>MSDN article: Task Parallel Library Overview: <a href="http://msdn.microsoft.com/en-us/library/dd460717(VS.100).aspx" target="_blank"><a href="http://msdn.microsoft.com/en-us/library/dd460717">http://msdn.microsoft.com/en-us/library/dd460717</a>(VS.100).aspx</a></p>

<p>Daniel Moth&#8217;s videocast and PPT deck: <a href="http://channel9.msdn.com/pdc2008/TL26/" target="_blank"><a href="http://channel9.msdn.com/pdc2008/TL26/">http://channel9.msdn.com/pdc2008/TL26/</a></a> and his article about thread pool at <a href="http://www.danielmoth.com/Blog/2008/11/new-and-improved-clr-4-thread-pool.html" target="_blank"><a href="http://www.danielmoth.com/Blog/2008/11/new-and-improved-clr-4-thread-pool.html">http://www.danielmoth.com/Blog/2008/11/new-and-improved-clr-4-thread-pool.html</a></a></p>

<p>My Code sample for PLINQ as used in this post is at <a href="http://www.udooz.net/file-drive/doc_details/9-tpl-and-plinq-example.html" target="_blank"><a href="http://www.udooz.net/file-drive/doc_details/9-tpl-and-plinq-example.html">http://www.udooz.net/file-drive/doc_details/9-tpl-and-plinq-example.html</a></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/08/parallel-programming-net-4-0-using-task/">Go Parallel with .NET 4.0 Parallel Extensions</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-08-26T00:00:00+05:30" pubdate data-updated="true"></time>
        
         | <a href="/blog/2009/08/parallel-programming-net-4-0-using-task/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>We are in the multi-core era, where our applications are expected to effectively use these cores.  Simply, go parallel, means that partitioning the work being done into smaller pieces those are executed on the available processors in the target system.  Until .NET 3.5, parallel means we are used to use <span style="color: #000000;">ThreadPool and Thread classes</span>.  We are not in a situation to have a component which partition and schedule work into work items on different cores.  A craft-and-weave <a href="http://software.intel.com/en-us/intel-parallel-studio-home/?cid=sw:multicore097" target="_blank">parallel framework from Intel</a> is available while for MC++ and not sure how easy it is to use.</p>

<blockquote><p>Even though threads are basic to parallel, from a developer perspective, what required for parallel programming is not the thread, work items in a work, named &#8220;Task&#8221;.</p></blockquote>

<h2>.NET 4.0 Parallel Extensions </h2>

<p>Task represents a work item being performed independently along with other work items.  This is the approach taken by the experts in Microsoft Parallel Computing division, and released parallel extensions (Task Parallel Library and Parallel LINQ) in .NET 4.0 beta 1.  As like Microsoft&#8217;s other frameworks, developers need not worry about the internals.  The task partitioning and scheduling of the work items are taken care by parallel extensions.</p>

<h3>Task and Thread</h3>

<p>Let us first understand the relationship between task and thread.  See the following figure.</p>

<p><img class="alignnone size-full wp-image-172" style="margin: 2px; border: black 1px solid;" title="Thread and Task Relationship" src="http://udooz.github.io//blog/images/2009/08/pfx_thread_task.png" alt="Thread and Task Relationship" width="530" height="226" /></p>

<p>Typically task is resided in a thread.  A task may contain one or more child tasks those are not necessarly resided in the parent task&#8217;s thread.  In the above figure, Child Task M2 of Task M resided in Thread B.</p>

<h2>Task Parallel Library (TPL)</h2>

<p>This library provides API to perform task based parallel programming under System.Threading and System.Threading.Tasks namespaces.  The partitioned tasks are automatically scheduled on available processors by Task Scheduler which is in ThreadPool.  The work stealing queue algorithm in the task scheduler makes the life easier.  I&#8217;ll explain about this in the next post. </p>

<blockquote><p>Scheduling the tasks on the processors is the runtime behaviour of the task scheduler, so it does support &#8216;scale up&#8217; without recompiling the program on the target machine with few or more cores. </p></blockquote>

<p>There are two types of parallelism you can do using TPL.</p>

<ul>
<li>Data Parallelism</li>
<li>Task Parallelism</li>
</ul>


<h3>Data Parallelism</h3>

<p>It is very common to perform a set of actions against each element in a collection of data using for and for..each.  Parallel.For() and Parallel.ForEach() enable to make your collection processing actions to be parallel.  The following figure depicts this.</p>

<p> <img class="alignnone size-full wp-image-176" style="margin: 2px; border: black 1px solid;" title="Data Parallelism" src="http://udooz.github.io//blog/images/2009/08/pfx_data_plsm1.png" alt="Data Parallelism" width="440" height="254" /></p>

<p>Let us see this with typical customer-order collection.  The following code shows Customer and Order declaration.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Customer</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">City</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">Order</span><span class="p">[]</span> <span class="n">Orders</span><span class="p">;</span>
</span><span class='line'> 
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">override</span> <span class="kt">string</span> <span class="n">ToString</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;Name: {0} - City: {1}&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="n">Name</span><span class="p">,</span> <span class="n">City</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Order</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">OrderId</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">Quantity</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">override</span> <span class="kt">string</span> <span class="n">ToString</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;Order Id: {0} - Quantity: {1}&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="n">OrderId</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let us create a in-memory collection for this as like below code.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="kt">var</span> <span class="n">customers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Customer</span><span class="p">[]</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">new</span> <span class="n">Customer</span><span class="p">{</span><span class="n">Name</span><span class="p">=</span><span class="s">&quot;Hussain&quot;</span><span class="p">,</span> <span class="n">City</span><span class="p">=</span><span class="s">&quot;Vizak&quot;</span><span class="p">,</span> <span class="n">Orders</span> <span class="p">=</span>
</span><span class='line'>        <span class="k">new</span> <span class="n">Order</span><span class="p">[]</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">new</span> <span class="n">Order</span><span class="p">{</span><span class="n">OrderId</span><span class="p">=</span><span class="m">1</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">=</span><span class="m">10</span><span class="p">},</span>
</span><span class='line'>            <span class="k">new</span> <span class="n">Order</span><span class="p">{</span><span class="n">OrderId</span><span class="p">=</span><span class="m">10</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">=</span><span class="m">5</span><span class="p">}</span>
</span><span class='line'>        <span class="p">}},</span>
</span><span class='line'>    <span class="k">new</span> <span class="n">Customer</span><span class="p">{</span><span class="n">Name</span><span class="p">=</span><span class="s">&quot;Abdul&quot;</span><span class="p">,</span> <span class="n">City</span><span class="p">=</span><span class="s">&quot;Chennai&quot;</span><span class="p">,</span> <span class="n">Orders</span> <span class="p">=</span>
</span><span class='line'>        <span class="k">new</span> <span class="n">Order</span><span class="p">[]</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">new</span> <span class="n">Order</span><span class="p">{</span><span class="n">OrderId</span><span class="p">=</span><span class="m">7</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">=</span><span class="m">2</span><span class="p">},</span>
</span><span class='line'>            <span class="k">new</span> <span class="n">Order</span><span class="p">{</span><span class="n">OrderId</span><span class="p">=</span><span class="m">10</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">=</span><span class="m">4</span><span class="p">}</span>
</span><span class='line'>        <span class="p">}},</span>
</span><span class='line'>    <span class="k">new</span> <span class="n">Customer</span><span class="p">{</span><span class="n">Name</span><span class="p">=</span><span class="s">&quot;Daniel&quot;</span><span class="p">,</span> <span class="n">City</span><span class="p">=</span><span class="s">&quot;Texas&quot;</span><span class="p">,</span> <span class="n">Orders</span> <span class="p">=</span>
</span><span class='line'>        <span class="k">new</span> <span class="n">Order</span><span class="p">[]</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">new</span> <span class="n">Order</span><span class="p">{</span><span class="n">OrderId</span><span class="p">=</span><span class="m">12</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">=</span><span class="m">3</span><span class="p">},</span>
</span><span class='line'>            <span class="k">new</span> <span class="n">Order</span><span class="p">{</span><span class="n">OrderId</span><span class="p">=</span><span class="m">7</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">=</span><span class="m">1</span><span class="p">},</span>
</span><span class='line'>            <span class="k">new</span> <span class="n">Order</span><span class="p">{</span><span class="n">OrderId</span><span class="p">=</span><span class="m">10</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">=</span><span class="m">1</span><span class="p">}</span>
</span><span class='line'>        <span class="p">}}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let us write a simple parallel code which iterate through each customers and its orders.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">Parallel</span><span class="p">.</span><span class="n">ForEach</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;(</span><span class="n">customers</span><span class="p">,</span>
</span><span class='line'>    <span class="n">customer</span> <span class="p">=&gt;</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;**** {0} ****&quot;</span><span class="p">,</span> <span class="n">customer</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span class='line'>        <span class="n">Parallel</span><span class="p">.</span><span class="n">ForEach</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;(</span><span class="n">customer</span><span class="p">.</span><span class="n">Orders</span><span class="p">,</span>
</span><span class='line'>            <span class="n">order</span> <span class="p">=&gt;</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t{0}&quot;</span><span class="p">,</span> <span class="n">order</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the above code, printing customer detail is one task and printing order detail for a specified customer is the child one for that.  I&#8217;ve taken simple overloaded version of For&#8230;Each</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="n">ParallelLoopResult</span> <span class="n">ForEach</span><span class="p">&lt;</span><span class="n">TSource</span><span class="p">&gt;(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TSource</span><span class="p">&gt;</span> <span class="n">source</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">TSource</span><span class="p">&gt;</span> <span class="n">body</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>The task scheduler partitions the customers and orders, and schedule them into available processors.</p>

<h3>Task Parallelism</h3>

<p>In cases like multiple distinct actions to be performed concurrently on the same or different source.  The following figure depicts this.  Note that task count need not be equal to number of actions.</p>

<p><img class="alignnone size-full wp-image-174" style="margin: 2px; border: black 1px solid;" title="Task Parallelism" src="http://udooz.github.io//blog/images/2009/08/pfx_task_plsm.png" alt="Task Parallelism" width="620" height="329" /></p>

<p>Parallel.Invoke() is used for this.  See the following code.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">Parallel</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(()</span> <span class="p">=&gt;</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Task 1.  Getting total quantity ordered for OrderId 10&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">orderId10Sum</span> <span class="p">=</span>
</span><span class='line'>            <span class="p">(</span><span class="k">from</span> <span class="n">c</span> <span class="k">in</span> <span class="n">customers</span>
</span><span class='line'>            <span class="k">from</span> <span class="n">o</span> <span class="k">in</span> <span class="n">c</span><span class="p">.</span><span class="n">Orders</span>
</span><span class='line'>            <span class="k">where</span> <span class="n">o</span><span class="p">.</span><span class="n">OrderId</span> <span class="p">==</span> <span class="m">10</span>                       
</span><span class='line'>            <span class="k">select</span> <span class="n">o</span><span class="p">.</span><span class="n">Quantity</span><span class="p">).</span><span class="n">Sum</span><span class="p">();</span>
</span><span class='line'>        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Quantity: {0}&quot;</span><span class="p">,</span> <span class="n">orderId10Sum</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},()</span> <span class="p">=&gt;</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Task 2.  Getting number of customers and their city ordered OrderId 7&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">items</span> <span class="p">=</span>
</span><span class='line'>            <span class="k">from</span> <span class="n">c</span> <span class="k">in</span> <span class="n">customers</span>
</span><span class='line'>            <span class="k">from</span> <span class="n">o</span> <span class="k">in</span> <span class="n">c</span><span class="p">.</span><span class="n">Orders</span>
</span><span class='line'>            <span class="k">where</span> <span class="n">o</span><span class="p">.</span><span class="n">OrderId</span> <span class="p">==</span> <span class="m">7</span>
</span><span class='line'>            <span class="k">select</span> <span class="n">c</span><span class="p">.</span><span class="n">City</span><span class="p">;</span>
</span><span class='line'>        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Count: {0}\nFrom following City:&quot;</span><span class="p">,</span> <span class="n">items</span><span class="p">.</span><span class="n">Count</span><span class="p">());</span>
</span><span class='line'> 
</span><span class='line'>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">city</span> <span class="k">in</span> <span class="n">items</span><span class="p">)</span>
</span><span class='line'>            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">city</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;ve taken the following overloaded version of Parallel.Invoke().</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Invoke</span><span class="p">(</span><span class="k">params</span> <span class="n">Action</span><span class="p">[]</span> <span class="n">actions</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;ve specified two different actions those are acted on customers.</p>

<p>The source code for this article is available at <a href="http://www.udooz.net/file-drive/doc_details/8-net-40-tlp-demo-1.html" target="_blank"><a href="http://www.udooz.net/file-drive/doc_details/8-net-40-tlp-demo-1.html">http://www.udooz.net/file-drive/doc_details/8-net-40-tlp-demo-1.html</a></a>.</p>

<p>In the next post, I&#8217;ll explain the more about tasks, Parallel LINQ portion and task scheduler.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="10">&larr; Older</a>
    
    <a href="/blog/blog/archives">Blog Archives</a>
    
    <a class="next" href="8">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
<section>
    <span>
        <img src="http://www.gravatar.com/avatar/d44d334346f00e4c04b5dc856ec3c7e2" alt="Gravatar of M Sheik Uduman Ali " title="Gravatar of M Sheik Uduman Ali" />
    </span>
</section>

<section>
  <h1>About Me</h1>
  <div id="twitter-profile" style="margin-top:0.5em;">
    <p>
      <strong>M Sheik Uduman Ali</strong> 
      (<a href="http://twitter.com/udooz">@udooz</a>)
    </p>
    <p></p>
  </div>
  <script type="text/javascript">
    $(function(){
        var container = $('#twitter-profile'),
            user = "udooz";
        
        function parseTwLinks(s) {
          var twUrl = "http://www.twitter.com/"
          s = s.replace(/ (@([\w]+))/g, function(match, p1, p2) {
              return " <a href='"+twUrl+p2+"'>"+p1+"</a>"
          }).replace(/ (#([\w]+))/g, function(match, p1, p2) {
              return " <a href='"+twUrl+"#!/search?q=%23"+p2+"'>"+p1+"</a>"
          })
          return s
        }

        $.ajax({
            url: "http://api.twitter.com/1/users/show.json?include_entities=false&screen_name="+user+"&callback=?"
          , type: 'GET'
          , dataType: 'jsonp'
          , error: function (err) { $('#twitter-profile').addClass('error');  }
          , success: function(data) {
              container.html('<img class="left" src="http://api.twitter.com/1/users/profile_image/'+user+'.json?size=bigger" alt="@'+user+'"><p><strong>'+data.name+'</strong> (<a href="http://twitter.com/'+user+'">@'+user+'</a>)<br/>'+data.location+'</p><p>'+parseTwLinks(data.description)+'</p>');
            }
        })
      });
  </script>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/06/dont-use-elephant-for-your-garden-work/">Don&#8217;t use elephant for your garden work</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/unpacking-apache-storm-in-developer-box/">Unpacking Apache Storm in developer box</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/book-review-heroku-up-and-running-by-neil-richard-oreilly/">Book Review &#8211; Heroku up and running by Neil &#038; Richard &#8211; O&#8217;Reilly</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/book-review-see-what-i-mean-oreilly/">Book Review &#8211; See What I Mean &#8211; O&#8217;Reilly</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/adopting-event-sourcing-in-saas-using-windows-azure/">Adopting Event Sourcing in SaaS using Windows Azure</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - M Sheik Uduman Ali -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'udooz';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
