
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Udooz!</title>
    <meta name="author" content="M Sheik Uduman Ali">
    
	<meta name="description" content="Published on: Tags: asp.net, azure Sometimes a small constraint make you scary.  Though I played around with HTTP persistence connection long back, &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Udooz!" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/blog/favicon.ico" rel="shortcut icon">
    <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='http://fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    <script type="text/javascript" src="/blog/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <script src="/javascripts/ajaxify.js"></script>
   
    
    

</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        Udooz!
    </div>
</h1>
<br>

<ul id="social-links" style="text-align:center">
  
  
  
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/blog/index.html">Home</a></li>
	<li id="ajax"><a href="/blog/blog/archives/index.html">Archives</a></li>
    <li><a href="/blog/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form method="get" action="/blog/search.html" id="search">
            <input name="query" type="text" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

<div id="toload">
<!-- begin toload --> 
    <div id="content" class="inner">
        


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/03/is-http-keep-alive-good-or-bad-in-azure/">
		
			Is HTTP Keep-Alive good or bad (in Azure)?</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2012-03-19T00:00:00+05:30" pubdate data-updated="true"></time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/blog/categories/asp-dot-net/'>asp.net</a>, <a class='category' href='/blog/blog/categories/azure/'>azure</a>


</div>
    </div>
		<p>Sometimes a small constraint make you scary.  Though I played around with HTTP persistence connection long back, recently when I saw this header while debugging an Azure application, I want to know what is the impact of this.  There are two different opinions on using HTTP Keeps-Alive header.  I want to know the impact on web apps hosted on Azure machines.  What are these opinions and what happened on Azure machines?<br/>
Before that, let us see what is HTTP Keeps-Alive and how it works in HTTP 1.1.  See the below figure.</p>

<p><a href="http://udooz.github.io//blog/images/2012/03/figure1.png" rel="prettyPhoto[369]"><img class="alignnone  wp-image-370" title="figure1" src="http://udooz.github.io//blog/images/2012/03/figure1.png" alt="" width="641" height="411" /></a></p>

<p>When a client  made a request to server with the header “Connection: Keep-Alive”, the server (here IIS 7.0) create a connection object for handling a request.  Once the response has sent, instead of closing the connection object, IIS keeps that because of the Keep-Alive instruction from client.  IIS also sends Keep-Alive header as part of the response means it is fine with HTTP Keep-Alive.  The connection object is alive for 2 minutes.  Within this period, if any other request from the same client comes, it reuses the same connection object for the request and also extens the timeout for next 2 minutes.  This will improves the responsiveness of your applications.  In the above figure, the numbers of actual clock time (hh:mm:ss:mss) the measurements taken. IIS team recommends to use this.  So, what is the improvement?</p>

<p>Let us see various end-to-end response time for with and without Keep-Alive options for 4 GET requests:</p>

<p><a href="http://udooz.github.io//blog/images/2012/03/figure2.png" rel="prettyPhoto[369]"><img class="alignnone size-full wp-image-371" title="figure2" src="http://udooz.github.io//blog/images/2012/03/figure2.png" alt="" width="789" height="122" /></a></p>

<p>The results show no major difference with or without having HTTP Keep-Alive option.  I’ve tried to give high stress to the system to find out the behavior changes in the server with or without HTTP Keep-Alive option.  Unfortunately, even I’ve unchecked the option, it sill works on Azure machines.</p>

<p>So, what I came to know is that using HTTP Keep-Alive neither make significant improvement nor lower the responsiveness.  Now, let us come to the main point for the purpose this post.</p>

<p>In the *nix world, people are not recommending to use this option.  In Apache, even if it is enabled, the time out period is 15 seconds in contrast with 2 minutes in IIS.  Surprisingly, Nginx’s default time out is 75 seconds.  The only problem most of the *nix people mentioned that, if your application has more number of resources (html + css + images) per single request, this is worth.  However, it is a 1:1, avoid it.  Keeping open connection on server costs high resource consumption in memory.</p>

<p>Is that make sense?  I think this is not applicable for IIS and Azure.</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/02/hadoop-on-azure-streaming-filenotfoundexception/">
		
			Hadoop On Azure: FileNotFoundException in Hadoop Streaming</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2012-02-07T00:00:00+05:30" pubdate data-updated="true"></time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/blog/categories/azure/'>azure</a>, <a class='category' href='/blog/blog/categories/hadoop/'>hadoop</a>


</div>
    </div>
		<p>The example description for Hadoop Streaming on Azure has some path typo error, hence you may struggle with following error:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>>Exception in thread "main" java.io.FileNotFoundException: File hdfs://xxx.xxx.xxx.xxx:9000/example/apps/wc.exe does not exist.
</span><span class='line'> at org.apache.hadoop.util.GenericOptionsParser.validateFiles(GenericOptionsParser.java:390)
</span><span class='line'> at org.apache.hadoop.util.GenericOptionsParser.processGeneralOptions(GenericOptionsParser.java:287)
</span><span class='line'> at org.apache.hadoop.util.GenericOptionsParser.parseGeneralOptions(GenericOptionsParser.java:413)
</span><span class='line'> at org.apache.hadoop.util.GenericOptionsParser.&lt;init>(GenericOptionsParser.java:164)
</span><span class='line'> at org.apache.hadoop.util.GenericOptionsParser.&lt;init>(GenericOptionsParser.java:147)</span></code></pre></td></tr></table></div></figure>


<p>The problem is with the &#8220;HDFS://&#8230;&#8221; arguments.  The sample gives the path like below</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>>hdfs://xxx.xxx.xxx.xxx:9000/example/apps/wc.exe</span></code></pre></td></tr></table></div></figure>


<p>This means the application is resided in example/apps.  When you access through HDFS URL, it starts from root directory, hence it founds any existence of &#8220;example&#8221; director in the root directory.  However, your actual directory in user/&lt;your_user_name>, where &#8220;user&#8221; is in the root directory.</p>

<p>Hence, the HDFS URL should be hdfs://xxx.xxx.xxx.xxx:9000/user/user_name/example/apps/wc.exe</p>

<p>Also, another parameter -input &#8220;/example/data/davinci.txt&#8221; -output &#8220;/example/data/StreamingOutput/wc.txt&#8221; actually mentions the input data and output directory.  Here also the &#8220;example&#8221; directory starts from root directory.  Instead, it should be &#8220;example/data&#8221;, which resolves to &#8220;user/user_name/example/data&#8221;.</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/01/partial-view-auto-refresh-in-asp-net-mvc3/">
		
			Partial View Auto Refresh in ASP.NET MVC3</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2012-01-11T00:00:00+05:30" pubdate data-updated="true"></time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/blog/categories/mvc-3/'>mvc 3</a>


</div>
    </div>
		<h2>Problem</h2>

<p>A partial view in ASP.NET MVC3 needs to be refreshed on every particular interval.</p>

<p>Let us take a typical ASP.NET MVC3 application. In the HomeController, there is a action called &#8220;Quote&#8221; which displays funny software quote for every new request like below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">HomeController</span> <span class="p">:</span> <span class="n">Controller</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">quotes</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;The first 90% of the code accounts for the first 90% of the development time. The remaining 10% of the code accounts for the other 90% of the development time&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;In order to understand recursion, one must first understand recursion&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;I have always wished for my computer to be as easy to use as my telephone; my wish has come true because I can no longer figure out how to use my telephone.&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;The gap between theory and practice is not as wide in theory as it is in practice.&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;Nine people can’t make a baby in a month&quot;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// other actions</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Quote</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kt">var</span> <span class="n">r</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Random</span><span class="p">();</span>
</span><span class='line'>      <span class="kt">var</span> <span class="n">rv</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">4</span><span class="p">);</span>
</span><span class='line'>      <span class="n">ViewBag</span><span class="p">.</span><span class="n">Quote</span> <span class="p">=</span> <span class="n">quotes</span><span class="p">[</span><span class="n">rv</span><span class="p">];</span>
</span><span class='line'>      <span class="k">return</span> <span class="nf">PartialView</span><span class="p">(</span><span class="s">&quot;_Quote&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The partial view &#8220;_Quote.cshtml&#8221; has nothing other than the code below</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;h3&gt;</span>@ViewBag.Quote<span class="nt">&lt;/h3&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This whole thing needs to be refreshed without any user interaction on every 10 seconds</p>

<h2>Solution</h2>

<p>Use setInterval() at client side and set up OutputCacheAttribute on the respective action. The duration should be same on both side.</p>

<p>In the corresponding script of this view, place the below JavaScript:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// jQuery used</span>
</span><span class='line'>
</span><span class='line'><span class="nx">setInterval</span><span class="p">(</span><span class="s2">&quot;$(&#39;#quote&#39;).load(&#39;/home/quote&#39;)&quot;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">);</span> <span class="c1">// every 10 sec</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the main view, create a div with id &#8220;quote&#8221; like:</p>

<p>In the action method set the OutputCacheAttribute like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[OutputCache(NoStore=true, Location = OutputCacheLocation.Client, Duration = 10)]</span> <span class="c1">// every 10 sec</span>
</span><span class='line'><span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Quote</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a style="display: none;" href="http://www.codeproject.com/script/Articles/BlogFeedList.aspx?amid=3057856" rel="tag">CodeProject</a></p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/11/unobtrusive-javascript-video-tutorial/">
		
			Unobtrusive JavaScript &#8211; Video Tutorial</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2011-11-14T00:00:00+05:30" pubdate data-updated="true"></time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/blog/categories/asp-dot-net/'>asp.net</a>, <a class='category' href='/blog/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/blog/categories/mvc-3/'>mvc 3</a>, <a class='category' href='/blog/blog/categories/uncategorized/'>uncategorized</a>


</div>
    </div>
		<div class="widgetwrap">
  <div id="youtube_embed_widget-3" class="widget widget_youtube_embed_widget">
    <h4 class="widgettitle">
      UdoozTube :: Hasha Tech Tutorial
    </h4>
    
    <p>
      <!-- YouTube Embed v2.1 | http://www.artiss.co.uk/artiss-youtube-embed -->
      
      <br /> <br /> <!-- End of YouTube Embed code --></div> </div>


		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/10/collection-binding-in-asp-net-mvc3-with-ajax/">
		
			Collection Binding in ASP.NET MVC3 with AJAX</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2011-10-20T00:00:00+05:30" pubdate data-updated="true"></time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/blog/categories/dot-net/'>.net</a>, <a class='category' href='/blog/blog/categories/asp-dot-net/'>asp.net</a>, <a class='category' href='/blog/blog/categories/mvc-3/'>mvc 3</a>


</div>
    </div>
		<p>There is a less-common scenario in web applications where we need to edit collection of objects and submit the whole back to the system. For example, let us take the below view model:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">FruitModel</span><span class="p">...</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsFresh</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsPacked</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">public</span> <span class="kt">decimal</span> <span class="n">UnitPrice</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The UI for this scenario is shown below:</p>

<p><a href="http://udooz.github.io//blog/images/2011/10/figure_1.png" rel="prettyPhoto[336]"><img class="alignnone size-full wp-image-338" style="border-width: 1px; border-color: black; border-style: solid;" title="figure_1" src="http://udooz.github.io//blog/images/2011/10/figure_1.png" alt="" width="547" height="426" /></a></p>

<p>Leave the top and bottom &#8220;Lorem ipsum&#8221; text, these are just gap fillers.  The user can change the &#8220;IsFresh&#8221; and &#8220;IsPacked&#8221; settings of the fruits and the unit prices.</p>

<h2>Challenge</h2>

<p>This post addresses the following simple problems when using ASP.NET MVC3:</p>

<ul>
<li>Sending back collection of data to a MVC action</li>
<li>Also send back additional parameter(s) to the same MVC action</li>
<li>Sending back read-only data</li>
<li>By Ajax</li>
</ul>


<h2>Solution</h2>

<div>
  When the user hitting this site, the HomeController&#8217;s Index will be called:
</div>




<div>
  <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Index</span><span class="p">()...</span>
</span><span class='line'>  <span class="n">List</span><span class="p">&lt;</span><span class="n">FruitModel</span><span class="p">&gt;</span> <span class="n">collection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">FruitModel</span><span class="p">&gt;()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">new</span> <span class="n">FruitModel</span> <span class="p">{</span><span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="n">IsFresh</span><span class="p">=</span><span class="k">true</span><span class="p">,</span> <span class="n">IsPacked</span><span class="p">=</span><span class="k">false</span><span class="p">,</span> <span class="n">UnitPrice</span> <span class="p">=</span> <span class="m">10</span><span class="n">M</span><span class="p">},</span>
</span><span class='line'>      <span class="k">new</span> <span class="n">FruitModel</span> <span class="p">{</span><span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;Orange&quot;</span><span class="p">,</span> <span class="n">IsFresh</span><span class="p">=</span><span class="k">false</span><span class="p">,</span> <span class="n">IsPacked</span><span class="p">=</span><span class="k">false</span><span class="p">,</span> <span class="n">UnitPrice</span> <span class="p">=</span> <span class="m">5</span><span class="n">M</span><span class="p">},</span>
</span><span class='line'>      <span class="k">new</span> <span class="n">FruitModel</span> <span class="p">{</span><span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;Strawberry&quot;</span><span class="p">,</span> <span class="n">IsFresh</span><span class="p">=</span><span class="k">true</span><span class="p">,</span> <span class="n">IsPacked</span><span class="p">=</span><span class="k">true</span><span class="p">,</span> <span class="n">UnitPrice</span> <span class="p">=</span> <span class="m">15</span><span class="n">M</span><span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="n">ViewBag</span><span class="p">.</span><span class="n">NetAmount</span> <span class="p">=</span> <span class="n">IncludeTax</span><span class="p">(</span><span class="n">collection</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">fm</span> <span class="p">=&gt;</span> <span class="n">fm</span><span class="p">.</span><span class="n">UnitPrice</span><span class="p">));</span>
</span><span class='line'>  <span class="n">ViewBag</span><span class="p">.</span><span class="n">ShopId</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">();</span>
</span><span class='line'>  <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">collection</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>
</div>




<div>
  In the Index view, I&#8217;ve used NetAmount value of ViewBag as shown below:
</div>




<div>
  <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;div&gt;</span>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;h2&gt;</span>Welcome to Fruit Shop<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'><span class="nt">&lt;div&gt;</span>Lorem ipsum... <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;div&gt;</span>
</span><span class='line'>  @Html.Partial(&quot;_Fruit&quot;, (List<span class="nt">&lt;MvcApplication1.Models.FruitModel&gt;</span>)Model)
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;netAmountDiv&quot;</span> <span class="na">name=</span><span class="s">&quot;netAmountDiv&quot;</span> <span class="na">style=</span><span class="s">&quot;color:Blue&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  Net Amount: @ViewBag.NetAmount
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;div&gt;</span>Lorem ipsum...<span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>
</div>




<div>
  The main part of the Fruit Shop is defined in _Fruit partial view.  It requires the FruitModel collection and shop ID (in ViewBag).
</div>


<blockquote><p><div>
  Simply passing the Model in @Html.Partial(&#8230;) will throw the error &#8220;&#8216;System.Web.Mvc.HtmlHelper<dynamic>&#8217; has no applicable method named &#8216;Partial&#8217; but appears to have an extension method by that name. Extension methods cannot be dynamically dispatched. Consider casting the dynamic arguments or calling the extension method without the extension method syntax.&#8221;.  So, cast it to appropriate type, here List&lt;MvcApplication1.Models.FruitModel>.
</div></p></blockquote>

<div>
  The partial view _Fruit is
</div>




<div>
  <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;div&gt;</span>
</span><span class='line'><span class="nt">&lt;pre&gt;</span>@model List<span class="nt">&lt;MvcApplication1.Models.FruitModel&gt;</span>
</span><span class='line'>
</span><span class='line'>@using (Ajax.BeginForm(new AjaxOptions
</span><span class='line'>        {
</span><span class='line'>            HttpMethod = &quot;Post&quot;,
</span><span class='line'>            UpdateTargetId = &quot;netAmountDiv&quot;
</span><span class='line'>        }
</span><span class='line'>))
</span><span class='line'>{
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;table&gt;</span>
</span><span class='line'>    <span class="nt">&lt;tr&gt;</span>
</span><span class='line'>        <span class="nt">&lt;th&gt;</span>
</span><span class='line'>            Name
</span><span class='line'>        <span class="nt">&lt;/th&gt;</span>
</span><span class='line'>        <span class="nt">&lt;th&gt;</span>
</span><span class='line'>            IsFresh
</span><span class='line'>        <span class="nt">&lt;/th&gt;</span>
</span><span class='line'>        <span class="nt">&lt;th&gt;</span>
</span><span class='line'>            IsPacked
</span><span class='line'>        <span class="nt">&lt;/th&gt;</span>
</span><span class='line'>        <span class="nt">&lt;th&gt;</span>Unit Price<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/tr&gt;</span>
</span><span class='line'>
</span><span class='line'>@for (int i = 0; i <span class="nt">&lt; Model.Count</span><span class="err">;</span> <span class="err">i++)</span>
</span><span class='line'><span class="err">{</span>
</span><span class='line'>    <span class="err">&lt;tr</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;td&gt;</span>
</span><span class='line'>            @Html.DisplayFor(modelItem =&gt; Model[i].Name)
</span><span class='line'>            @Html.HiddenFor(modelItem =&gt; Model[i].Name)
</span><span class='line'>        <span class="nt">&lt;/td&gt;</span>
</span><span class='line'>        <span class="nt">&lt;td&gt;</span>
</span><span class='line'>            @Html.EditorFor(modelItem =&gt; Model[i].IsFresh)
</span><span class='line'>        <span class="nt">&lt;/td&gt;</span>
</span><span class='line'>        <span class="nt">&lt;td&gt;</span>
</span><span class='line'>            @Html.EditorFor(modelItem =&gt; Model[i].IsPacked)
</span><span class='line'>        <span class="nt">&lt;/td&gt;</span>
</span><span class='line'>        <span class="nt">&lt;td&gt;</span>
</span><span class='line'>            @Html.EditorFor(modelItem =&gt; Model[i].UnitPrice)
</span><span class='line'>        <span class="nt">&lt;/td&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/tr&gt;</span>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/table&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">id=</span><span class="s">&quot;shopId&quot;</span> <span class="na">name=</span><span class="s">&quot;shopId&quot;</span> <span class="na">value=</span><span class="s">&quot;@ViewBag.ShopId&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div&gt;</span>
</span><span class='line'>          <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;submitFruit&quot;</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Change&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>
</div>




<div>
  Now the important point here is, when you want to post back collection of FruitModel, the naming pattern of every HTML item in the collection should be &#8220;obj-name[index].property-name&#8221;.  For example, for the above code, ASP.NET generates HTML for an item like below:
</div>




<div>
  <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;div&gt;</span>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;td&gt;</span>
</span><span class='line'>  Apple
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;[0].Name&quot;</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">value=</span><span class="s">&quot;Apple&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/td&gt;</span>
</span><span class='line'><span class="nt">&lt;td&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">checked=</span><span class="s">&quot;checked&quot;</span> <span class="na">class=</span><span class="s">&quot;check-box&quot;</span> <span class="na">data-val=</span><span class="s">&quot;true&quot;</span> <span class="na">data-val-required=</span><span class="s">&quot;The IsFresh field is required.&quot;</span> <span class="na">name=</span><span class="s">&quot;[0].IsFresh&quot;</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;&lt;input</span> <span class="na">name=</span><span class="s">&quot;[0].IsFresh&quot;</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/td&gt;</span>
</span><span class='line'><span class="nt">&lt;td&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">&quot;check-box&quot;</span> <span class="na">data-val=</span><span class="s">&quot;true&quot;</span> <span class="na">data-val-required=</span><span class="s">&quot;The IsPacked field is required.&quot;</span> <span class="na">name=</span><span class="s">&quot;[0].IsPacked&quot;</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;&lt;input</span> <span class="na">name=</span><span class="s">&quot;[0].IsPacked&quot;</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/td&gt;</span>
</span><span class='line'><span class="nt">&lt;td&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">&quot;text-box single-line&quot;</span> <span class="na">data-val=</span><span class="s">&quot;true&quot;</span> <span class="na">data-val-number=</span><span class="s">&quot;The field UnitPrice must be a number.&quot;</span> <span class="na">data-val-required=</span><span class="s">&quot;The UnitPrice field is required.&quot;</span> <span class="na">name=</span><span class="s">&quot;[0].UnitPrice&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">value=</span><span class="s">&quot;10.00&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/td&gt;&lt;/pre&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;div&gt;</span>
</span></code></pre></td></tr></table></div></figure>
</div>




<div>
  This HTML code actually generate a post back collection as shown below when submitting the form.
</div>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>submitFruit=Change&[0].Name=Apple&[0].IsFresh=true&[0].IsFresh=false&[0].IsPacked=false&
</span><span class='line'>[0].UnitPrice=10.00&[1].Name=Orange&[1].IsFresh=false&[1].IsPacked=true&[1].IsPacked=false&
</span><span class='line'>[1].UnitPrice=5.00&[2].Name=Strawberry&[2].IsFresh=true&[2].IsFresh=false&[2].IsPacked=true&
</span><span class='line'>[2].IsPacked=false&[2].UnitPrice=25&shopId=c9517c6b-c911-4a28-9a0a-3e47ccb60bd8&X-Requested-With=XMLHttpRequest</span></code></pre></td></tr></table></div></figure>




<div>
  The above data matched with List<FruitModel> model and with the other parameter name too.  The additional parameter I&#8217;m passing is &#8220;shopId&#8221; hidden value which is received from ViewBag.ShopId.  The main changes I did in the above code are:
</div>


<ul>
<li><span class="Apple-style-span" style="font-family: Consolas, Monaco, monospace; font-size: 12px; line-height: 18px; white-space: pre;">Used List<T> for @model instead of IEnumerable<T>, hence I can use Count property.</span></li>
<li>Used for i = 0&#8230;List<T>.Count instead of foreach.</li>
</ul>


<div>
  ASP.NET MVC3 uses &#8220;name.propertyname&#8221; pattern, if you use &#8220;foreach&#8221;.  This wouldn&#8217;t send back the collection to the server.  Now, let us see the Index action for POST:
</div>




<div>
  <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="p">&lt;/</span><span class="n">div</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">&lt;</span><span class="n">div</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;[</span><span class="n">HttpPost</span><span class="p">]</span>
</span><span class='line'><span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Index</span><span class="p">(</span><span class="n">Guid</span> <span class="n">shopId</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">FruitModel</span><span class="p">&gt;</span> <span class="n">collection</span><span class="p">)...</span>
</span><span class='line'>  <span class="kt">decimal</span> <span class="n">addlTax</span> <span class="p">=</span> <span class="m">0</span><span class="n">M</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">collection</span><span class="p">.</span><span class="n">Any</span><span class="p">(</span><span class="n">fm</span> <span class="p">=&gt;</span> <span class="n">fm</span><span class="p">.</span><span class="n">UnitPrice</span> <span class="p">&gt;</span> <span class="m">200</span><span class="p">))</span> <span class="n">addlTax</span> <span class="p">+=</span> <span class="m">2</span><span class="n">M</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="nf">Content</span><span class="p">(</span><span class="s">&quot;Net Amount: &quot;</span> <span class="p">+</span> <span class="n">IncludeTax</span><span class="p">(</span><span class="n">collection</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">fm</span> <span class="p">=&gt;</span> <span class="n">fm</span><span class="p">.</span><span class="n">UnitPrice</span><span class="p">)</span> <span class="p">+</span> <span class="n">addlTax</span><span class="p">).</span><span class="n">ToString</span><span class="p">());&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">div</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">&lt;</span><span class="n">div</span><span class="p">&gt;</span>
</span></code></pre></td></tr></table></div></figure>
</div>




<div>
  Leave the tax calculation stuff, it is just for making some difference from GET Index().  The above method send back the tax calculation as plain text to the client.  This is the place for AJAX.  This can be achieved by Ajax.BeginForm() in the above code, where I&#8217;ve mentioned that the result should be placed on an element with id &#8220;netAmountDiv&#8221;.  So, we can get the result asynchronously.  To make this AJAX.BeginForm() to work, you have to:
</div>




<div>
  <ul>
    <li>
      include jQuery&#8217;s unobtrusive AJAX script (jquery.unobtrusive-AJAX.min.js)
    </li>
    <li>
      add &#8220;<add key=&#8221;UnobtrusiveJavaScriptEnabled&#8221; value=&#8221;true&#8221; />&#8221; option in appsetting section of web.config
    </li>
  </ul>
  
  <p>
    Also, note that to send read-only item as part of the collection, in the above example FruitModel.Name, use hidden input control also.
  </p>
</div>


<p><a style="display: none;" href="http://www.codeproject.com/script/Articles/BlogFeedList.aspx?amid=3057856" rel="tag">CodeProject</a></p>

		
		
	</div>

<div class="meta">
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="4" class="prev">Prev</a>
    
    
        <a href="6" class="next">Next</a>
    
    <div class="center"><a href="/blog/blog/archives">Blog Archives</a></div>
</nav>

    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2014

    M Sheik Uduman Ali
. Powered by <a href="http://octopress.org">Octopress</a> | 
    Theme <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/blog/javascripts/fabric.js"></script>
<script src="/blog/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
