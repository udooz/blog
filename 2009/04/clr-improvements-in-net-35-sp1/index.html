
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>CLR Improvements in .NET 3.5 SP1 - Udooz!</title>
    <meta name="author" content="M Sheik Uduman Ali">
    
	<meta name="description" content="When I was downloading the SP1 of .NET 3.5 months before, I did not realized that there are some CLR improvements in that release apart from some new &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Udooz!" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/blog/favicon.ico" rel="shortcut icon">
    <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='http://fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    <script type="text/javascript" src="/blog/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <script src="/javascripts/ajaxify.js"></script>
   
    
    

</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        M Sheik Uduman Ali
    </div>
</h1>
<br>

<ul id="social-links" style="text-align:center">
  
  
  
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/blog/index.html">Home</a></li>
	<li id="ajax"><a href="/blog/blog/archives/index.html">Archives</a></li>
    <li><a href="/blog/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form method="get" action="/blog/search.html" id="search">
            <input name="query" type="text" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

<div id="toload">
<!-- begin toload --> 
    <div id="content" class="inner">
        <article class="post">
	<h2 class="title">CLR Improvements in .NET 3.5 SP1</h2>
	<div class="entry-content"><p>When I was downloading the SP1 of .NET 3.5 months before, I did not realized that there are some CLR improvements in that release apart from some new features such as ADO.NET data services, improved WCF, etc.  The improvements are expected to be in .NET 4.0 (CLR 4.0?), however .NET 3.5 SP1 has some CLR improvements:</p>

<ul>
<li>Improved application start-up performance (good news for WinForm applications).</li>
<li>JIT code optimizations which improves end-to-end application performance.</li>
<li>Opting managed code run in ASLR mode.</li>
<li>Improved NGen.</li>
<li>20-45% performance improvements of WPF applicaiton without any code change.</li>
<li>ClickOnce improvements.</li>
</ul>


<p>I am more instrested in JIT optimization done in SP1.  Let us see those improvements.</p>

<p><strong>Inlining and Structs</strong></p>

<blockquote><p>Inline Method: Place a method&#8217;s body into the body of its callers and remove the method (function pointer).  This is an explicit option in C++, however C# (.NET) doesn&#8217;t has, because it is in CLR&#8217;s hand.</p></blockquote>

<p>For those, who don&#8217;t know about inline method, here the example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="p">+</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">c</span> <span class="p">=</span> <span class="k">add</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// CLR actually inline &quot;add&quot;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">c</span> <span class="p">=</span> <span class="m">5</span><span class="p">+</span><span class="m">6</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The major benefit of the above inline method is the number of IL code generated for &#8220;inline&#8221; method which inherently give performance benefit.  Since, inline is in CLR&#8217;s control, it does not treat a method as inline for the following:</p>

<ul>
<li>Methods greater than 32 bytes of IL.</li>
<li>Methods with &#8220;while&#8221;/&#8221;switch&#8221;.</li>
<li>Methods with &#8220;struct&#8221; argument(s).</li>
<li>Virtual methods.</li>
<li>Methods handling exception-handling.</li>
</ul>


<p>In 3.5SP1, methods with &#8220;struct&#8221; argument are treated as &#8220;inline&#8221; if it satisfies other 4 constraints.</p>

<p><strong>Improved Assertions</strong></p>

<p>Null and range check, typeof check and comparisons have been improved.</p>

<p><strong>Branch Straightening</strong></p>

<p>JIT compiler now able to straighten the code branch based on common code path and fall-through code path justification.  Based on this, fall-through codes are moved further down.  Based on Surupas Biswas article, there was 10% improvement in throughput in some ASP.NET benchmarks.</p>

<p>Let us see more about NGen improvements and ASLR mode usage in another post.</p>
</div>

<div class="meta">
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2014

    M Sheik Uduman Ali
. Powered by <a href="http://octopress.org">Octopress</a> | 
    Theme <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/blog/javascripts/fabric.js"></script>
<script src="/blog/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
