
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>CLR Improvements in .NET 3.5 SP1 - Udooz!</title>
  <meta name="author" content="M Sheik Uduman Ali">

  
  <meta name="description" content="Tweet CLR Improvements in .NET 3.5 SP1 When I was downloading the SP1 of .NET 3.5 months before, I did not realized that there are some CLR &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://udooz.github.io//blog/2009/04/clr-improvements-in-net-35-sp1/">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="/blog/javascripts/ender.js"></script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Udooz!" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body >
  <header role="banner" id="sidebar">
    <!-- Logo -->
<aside id="logo" class="clearfix">
  <div class="clearfix">
    <a href="/blog/">Udooz!</a>
  </div>
</aside>

<ul id="menu">

  <li class="title">
    <h1 id="title"><a href="/blog/">Udooz!</a></h1>
  </li>


  <li class="subtitle">
    <h2 id="subtitle">technologies.each { |tech| write_post(tech.facets) if tech.facets</h2>
  </li>

  <li class="link">
    <a href="/about/">about</a>
  </li>


  <li class="link rss">
    <a href="/atom.xml">rss feed</a>
  </li>
</ul>


<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:udooz.github.io//blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>


<!-- Octopress Love -->
<aside id="octopress_linkback">
  <a href="http://octopress.org/">
    <span class="unicode_square">
      <span class="unicode_circle">
        &nbsp;
      </span>
    </span>
    <span class="octopress">Powered by Octopress</span>
  </a>
</aside>

  </header>
  <section id="main">
    <article class="post">
  <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://udooz.github.io//blog/2009/04/clr-improvements-in-net-35-sp1/" data-via="" data-counturl="http://udooz.github.io//blog/2009/04/clr-improvements-in-net-35-sp1/" data-size="large">Tweet</a>
  
  
  
</div>

  
  <header>
    
      <h2 class="entry-title">CLR Improvements in .NET 3.5 SP1</h2>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-07T00:00:00+05:30" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<p>When I was downloading the SP1 of .NET 3.5 months before, I did not realized that there are some CLR improvements in that release apart from some new features such as ADO.NET data services, improved WCF, etc.  The improvements are expected to be in .NET 4.0 (CLR 4.0?), however .NET 3.5 SP1 has some CLR improvements:</p>

<ul>
<li>Improved application start-up performance (good news for WinForm applications).</li>
<li>JIT code optimizations which improves end-to-end application performance.</li>
<li>Opting managed code run in ASLR mode.</li>
<li>Improved NGen.</li>
<li>20-45% performance improvements of WPF applicaiton without any code change.</li>
<li>ClickOnce improvements.</li>
</ul>


<p>I am more instrested in JIT optimization done in SP1.  Let us see those improvements.</p>

<p><strong>Inlining and Structs</strong></p>

<blockquote><p>Inline Method: Place a method&#8217;s body into the body of its callers and remove the method (function pointer).  This is an explicit option in C++, however C# (.NET) doesn&#8217;t has, because it is in CLR&#8217;s hand.</p></blockquote>

<p>For those, who don&#8217;t know about inline method, here the example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="p">+</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">c</span> <span class="p">=</span> <span class="k">add</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// CLR actually inline &quot;add&quot;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">c</span> <span class="p">=</span> <span class="m">5</span><span class="p">+</span><span class="m">6</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The major benefit of the above inline method is the number of IL code generated for &#8220;inline&#8221; method which inherently give performance benefit.  Since, inline is in CLR&#8217;s control, it does not treat a method as inline for the following:</p>

<ul>
<li>Methods greater than 32 bytes of IL.</li>
<li>Methods with &#8220;while&#8221;/&#8221;switch&#8221;.</li>
<li>Methods with &#8220;struct&#8221; argument(s).</li>
<li>Virtual methods.</li>
<li>Methods handling exception-handling.</li>
</ul>


<p>In 3.5SP1, methods with &#8220;struct&#8221; argument are treated as &#8220;inline&#8221; if it satisfies other 4 constraints.</p>

<p><strong>Improved Assertions</strong></p>

<p>Null and range check, typeof check and comparisons have been improved.</p>

<p><strong>Branch Straightening</strong></p>

<p>JIT compiler now able to straighten the code branch based on common code path and fall-through code path justification.  Based on this, fall-through codes are moved further down.  Based on Surupas Biswas article, there was 10% improvement in throughput in some ASP.NET benchmarks.</p>

<p>Let us see more about NGen improvements and ASLR mode usage in another post.</p>



</article>


    <nav role="navigation" id="pagination">

</nav>
  </section>
  

  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
