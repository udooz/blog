
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>WCF Claims, STS and Federation &#8211; Layman&#8217;s View - Udooz!</title>
  <meta name="author" content="M Sheik Uduman Ali">

  
  <meta name="description" content="Tweet WCF Claims, STS and Federation &#8211; Layman&#8217;s View Configuring your Federation I&#8217;m here to explain WCF claims in federated &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://udooz.github.io//blog/2010/12/wcf-sts-federation-claims/">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="/blog/javascripts/ender.js"></script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Udooz!" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body >
  <header role="banner" id="sidebar">
    <!-- Logo -->
<aside id="logo" class="clearfix">
  <div class="clearfix">
    <a href="/blog/">Udooz!</a>
  </div>
</aside>

<ul id="menu">

  <li class="title">
    <h1 id="title"><a href="/blog/">Udooz!</a></h1>
  </li>


  <li class="subtitle">
    <h2 id="subtitle">technologies.each { |tech| write_post(tech.facets) if tech.facets</h2>
  </li>

  <li class="link">
    <a href="/about/">about</a>
  </li>


  <li class="link rss">
    <a href="/atom.xml">rss feed</a>
  </li>
</ul>


<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:udooz.github.io//blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>


<!-- Octopress Love -->
<aside id="octopress_linkback">
  <a href="http://octopress.org/">
    <span class="unicode_square">
      <span class="unicode_circle">
        &nbsp;
      </span>
    </span>
    <span class="octopress">Powered by Octopress</span>
  </a>
</aside>

  </header>
  <section id="main">
    <article class="post">
  <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://udooz.github.io//blog/2010/12/wcf-sts-federation-claims/" data-via="" data-counturl="http://udooz.github.io//blog/2010/12/wcf-sts-federation-claims/" data-size="large">Tweet</a>
  
  
  
</div>

  
  <header>
    
      <h2 class="entry-title">WCF Claims, STS and Federation &#8211; Layman&#8217;s View</h2>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-15T00:00:00+05:30" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<h2>Configuring your Federation<a href="http://udooz.github.io//blog/images/2010/12/STS_2_2.png" rel="prettyPhoto[250]"></a></h2>

<p>I&#8217;m here to explain WCF claims in federated services using STS (security token service) from a layman&#8217;s perspective.  I&#8217;ve started with the set of configuration you have to put in place on web.config under system.serviceModel to make your service in federated way.  Instead of very boring textual explanation, I&#8217;m explaining in comic way. </p>

<p> <a href="http://udooz.github.io//blog/images/2010/12/STS_1-1.png" rel="prettyPhoto[250]"><img class="size-full wp-image-251 alignnone" title="STS_1-1" src="http://udooz.github.io//blog/images/2010/12/STS_1-1.png" alt="" width="302" height="309" /></a><a href="http://udooz.github.io//blog/images/2010/12/STS_1-2.png" rel="prettyPhoto[250]"><img class="alignnone size-full wp-image-252" title="STS_1-2" src="http://udooz.github.io//blog/images/2010/12/STS_1-2.png" alt="" width="301" height="307" /></a> </p>

<p> <a href="http://udooz.github.io//blog/images/2010/12/STS_1-3.png" rel="prettyPhoto[250]"><img class="alignnone size-full wp-image-253" title="STS_1-3" src="http://udooz.github.io//blog/images/2010/12/STS_1-3.png" alt="" width="303" height="310" /></a><a href="http://udooz.github.io//blog/images/2010/12/STS_2_1.png" rel="prettyPhoto[250]"><img class="alignnone size-full wp-image-254" title="STS_2_1" src="http://udooz.github.io//blog/images/2010/12/STS_2_1.png" alt="" width="300" height="305" /></a> </p>

<p>This is to be declared inside <binding> &ndash;> <security> element of system.serviceModel section of web.config. </p>

<p><a href="http://udooz.github.io//blog/images/2010/12/STS_2_2.png" rel="prettyPhoto[250]"><img class="alignnone size-full wp-image-255" title="STS_2_2" src="http://udooz.github.io//blog/images/2010/12/STS_2_2.png" alt="" width="301" height="306" /></a><a href="http://udooz.github.io//blog/images/2010/12/STS_2_3.png" rel="prettyPhoto[250]"><img class="alignnone size-full wp-image-256" title="STS_2_3" src="http://udooz.github.io//blog/images/2010/12/STS_2_3.png" alt="" width="301" height="306" /></a> </p>

<p><a href="http://udooz.github.io//blog/images/2010/12/STS_3_1.png" rel="prettyPhoto[250]"><img class="alignnone size-full wp-image-257" title="STS_3_1" src="http://udooz.github.io//blog/images/2010/12/STS_3_1.png" alt="" width="301" height="307" /></a> </p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'> 
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;wsFederationHttpBinding&gt;</span>
</span><span class='line'> <span class="nt">&lt;binding</span> <span class="na">name=</span><span class="s">&quot;wsFed&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;security</span> <span class="na">mode=</span><span class="s">&quot;Message&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>   <span class="nt">&lt;message</span> <span class="na">issuedTokenType=</span><span class="s">&quot;&lt;strong&gt;http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1&lt;/strong&gt;&quot;</span> <span class="na">negotiateServiceCredential=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>    
</span><span class='line'>    <span class="nt">&lt;issuer</span> <span class="na">address=</span><span class="s">&quot;&lt;strong&gt;http://udoozSTS/TokenService.svc&lt;/strong&gt;&quot;</span> <span class="na">binding =</span><span class="s">&quot;wsHttpBinding&quot;</span>  <span class="na">bindingConfiguration=</span><span class="s">&quot;udoozSTSBinding&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>     
</span><span class='line'>    <span class="nt">&lt;/issuer&gt;</span>
</span><span class='line'>   <span class="nt">&lt;/message&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/security&gt;</span>
</span><span class='line'> <span class="nt">&lt;/binding&gt;</span>
</span><span class='line'><span class="nt">&lt;/wsFederationHttpBinding&gt;</span>
</span><span class='line'> 
</span></code></pre></td></tr></table></div></figure>


<p>The <issuer> is the place you have to tell where STS is hosted over which binding with appropriate binding configuration.  This service expects SAML 1.1 provided by udoozSTS.  Since, this is expected as part of request message, it has been declared in Message security mode. </p>

<p><a href="http://udooz.github.io//blog/images/2010/12/STS_3_2.png" rel="prettyPhoto[250]"><img class="alignnone size-full wp-image-258" title="STS_3_2" src="http://udooz.github.io//blog/images/2010/12/STS_3_2.png" alt="" width="302" height="307" /></a> </p>

<p>This is has to be declared in <identity> section of <issuer>. </p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'> 
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;identity&gt;</span>
</span><span class='line'>         <span class="nt">&lt;certificateReference</span>
</span><span class='line'>              <span class="na">findValue=</span><span class="s">&quot;WCFServerKey&quot;</span>
</span><span class='line'>              <span class="na">x509FindType=</span><span class="s">&quot;FindBySubjectName&quot;</span>
</span><span class='line'>              <span class="na">storeLocation=</span><span class="s">&quot;LocalMachine&quot;</span>
</span><span class='line'>              <span class="na">storeName=</span><span class="s">&quot;TrustedPeople&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'> 
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/identity&gt;</span>
</span><span class='line'> 
</span></code></pre></td></tr></table></div></figure>


<p> <a href="http://udooz.github.io//blog/images/2010/12/STS_3_3.png" rel="prettyPhoto[250]"><img class="alignnone size-full wp-image-259" title="STS_3_3" src="http://udooz.github.io//blog/images/2010/12/STS_3_3.png" alt="" width="302" height="307" /></a> </p>

<p>This has to be declared in <claimTypeRequirements> element under <message>. </p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'> 
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;claimTypeRequirements&gt;</span>
</span><span class='line'> <span class="nt">&lt;add</span> <span class="na">claimType=</span><span class="s">&quot;http://schemas.udooz.net/2010/12/identity/claims/facebookId&quot;</span> <span class="na">isOptional=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'> <span class="nt">&lt;add</span> <span class="na">claimType=</span><span class="s">&quot;http://schemas.udooz.net/2010/12/identity/claims/orgName&quot;</span> <span class="na">isOptional=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/claimTypeRequirements&gt;</span> 
</span></code></pre></td></tr></table></div></figure>


<p> The whole configuration  related to this as </p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;/pre&gt;</span>
</span><span class='line'> <span class="nt">&lt;bindings&gt;</span>
</span><span class='line'> <span class="nt">&lt;wsFederationHttpBinding&gt;</span>
</span><span class='line'>  <span class="nt">&lt;binding</span> <span class="na">name=</span><span class="s">&quot;mrservice&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>   <span class="nt">&lt;security</span> <span class="na">mode=</span><span class="s">&quot;Message&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;message</span> <span class="na">issuedTokenType=</span><span class="s">&quot;http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1&quot;</span> <span class="na">negotiateServiceCredential=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>     <span class="nt">&lt;claimTypeRequirements&gt;</span>
</span><span class='line'>      <span class="nt">&lt;add</span> <span class="na">claimType=</span><span class="s">&quot;http://schemas.udooz.net/2010/12/identity/claims/facebookId&quot;</span> <span class="na">isOptional=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;add</span> <span class="na">claimType=</span><span class="s">&quot;http://schemas.udooz.net/2010/12/identity/claims/orgName&quot;</span> <span class="na">isOptional=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>     <span class="nt">&lt;/claimTypeRequirements&gt;</span>
</span><span class='line'>     <span class="nt">&lt;issuer</span> <span class="na">address=</span><span class="s">&quot;http://udoozSTS/TokenService.svc&quot;</span> <span class="na">binding =</span><span class="s">&quot;wsHttpBinding&quot;</span>  <span class="na">bindingConfiguration=</span><span class="s">&quot;udoozSTSBinding&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;identity&gt;</span>
</span><span class='line'>       <span class="nt">&lt;certificateReference</span>
</span><span class='line'>         <span class="na">findValue=</span><span class="s">&quot;WCFServerKey&quot;</span>
</span><span class='line'>         <span class="na">x509FindType=</span><span class="s">&quot;FindBySubjectName&quot;</span>
</span><span class='line'>         <span class="na">storeLocation=</span><span class="s">&quot;LocalMachine&quot;</span>
</span><span class='line'>         <span class="na">storeName=</span><span class="s">&quot;TrustedPeople&quot;</span> <span class="nt">/&gt;</span>                 
</span><span class='line'>      <span class="nt">&lt;/identity&gt;</span>
</span><span class='line'>     <span class="nt">&lt;/issuer&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/message&gt;</span>
</span><span class='line'>   <span class="nt">&lt;/security&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/binding&gt;</span>
</span><span class='line'> <span class="nt">&lt;/wsFederationHttpBinding&gt;</span>
</span><span class='line'><span class="nt">&lt;bindings&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The proofs are called as claims.  A collection of claims about a consumer provided by a identity provider (STS) with its identity is called as ClaimSet.</p>

<p>The comic was developed using <a href="http://udooz.github.io//blog/images/2010/12/1.png" rel="prettyPhoto[250]"><img class="alignnone size-full wp-image-261" title="1" src="http://udooz.github.io//blog/images/2010/12/1.png" alt="" width="592" height="46" /></a>.</p>

<p><em>To be continued&#8230;</em><br/>
<a style="display: none;" rel="tag" href="http://udooz.net/blog/2010/12/wcf-sts-federation-claims">CodeProject</a></p>



</article>


    <nav role="navigation" id="pagination">

</nav>
  </section>
  

  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
